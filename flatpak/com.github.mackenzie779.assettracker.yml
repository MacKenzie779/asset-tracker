app-id: com.github.mackenzie779.assettracker
runtime: org.gnome.Platform
runtime-version: '47'        # or '46' if you prefer that runtime
sdk: org.gnome.Sdk
command: assettracker

# Permissions your Tauri app typically needs
finish-args:
  - --share=network
  - --socket=x11
  - --socket=wayland
  - --device=dri
  - --talk-name=org.freedesktop.Notifications
  - --talk-name=org.freedesktop.portal.*
  - --filesystem=home
  # If you use the Single Instance plugin:
  # - --own-name=org.de_mackenzie_AssetTracker.SingleInstance


modules:
  - name: assettracker
    buildsystem: simple
    sources:
      - type: file
        path: assettracker.deb    # we copy the built .deb here in CI
    build-commands:
      - bsdtar --to-stdout -xf assettracker.deb data.* | bsdtar -x -C /app -f -
      - install -d /app/bin && ln -sf /app/usr/bin/asset-tracker /app/bin/assettracker
      # rename whatever we find to match app-id and icon expectations
      - |
        df=$(ls /app/usr/share/applications/*.desktop | head -n1)
        install -D "$df" "/app/usr/share/applications/com.github.mackenzie779.assettracker.desktop"
      - |
        for size in 16 24 32 48 64 128 256 512; do
          d="/app/usr/share/icons/hicolor/${size}x${size}/apps"
          if ls "$d"/*.png >/dev/null 2>&1; then
            for f in "$d"/*.png; do
              install -D "$f" "$d/com.github.mackenzie779.assettracker.png"
            done
          fi
        done
    cleanup:
      - /usr/share/doc
      - /usr/share/man
